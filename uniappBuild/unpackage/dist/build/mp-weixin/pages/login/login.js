(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/login/login"],{1245:function(e,n,t){"use strict";t.r(n);var o=t("f705"),i=t("a0a3");for(var s in i)"default"!==s&&function(e){t.d(n,e,(function(){return i[e]}))}(s);t("f54b");var r,c=t("f0c5"),a=Object(c["a"])(i["default"],o["b"],o["c"],!1,null,null,null,!1,o["a"],r);n["default"]=a.exports},7471:function(e,n,t){},a0a3:function(e,n,t){"use strict";t.r(n);var o=t("d306"),i=t.n(o);for(var s in o)"default"!==s&&function(e){t.d(n,e,(function(){return o[e]}))}(s);n["default"]=i.a},d306:function(e,n,t){"use strict";(function(e,o){Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;s(t("2931"));var i=t("2f62");function s(e){return e&&e.__esModule?e:{default:e}}function r(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);n&&(o=o.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,o)}return t}function c(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?r(Object(t),!0).forEach((function(n){a(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):r(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function a(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}var l=function(){t.e("components/m-input").then(function(){return resolve(t("c1ab"))}.bind(null,t)).catch(t.oe)},u={components:{mInput:l},data:function(){return{loginType:0,loginTypeList:["密码登录"],mobile:"",code:"",providerList:[],hasProvider:!1,username:"",password:"",positionTop:0,isDevtools:!1,codeDuration:0}},computed:(0,i.mapState)(["forcedLogin"]),methods:c({},(0,i.mapMutations)(["login"]),{initProvider:function(){var n=this,t=["weixin","qq","sinaweibo"];e.getProvider({service:"oauth",success:function(e){if(e.provider&&e.provider.length){for(var o=0;o<e.provider.length;o++)~t.indexOf(e.provider[o])&&n.providerList.push({value:e.provider[o],image:"../../static/img/"+e.provider[o]+".png"});n.hasProvider=!0}},fail:function(e){console.error("获取服务供应商失败："+JSON.stringify(e))}})},initPosition:function(){this.positionTop=e.getSystemInfoSync().windowHeight-100},sendSmsCode:function(){var n=this;this.codeDuration&&e.showModal({content:"请在".concat(this.codeDuration,"秒后重试"),showCancel:!1}),/^1\d{10}$/.test(this.mobile)?o.callFunction({name:"user-center",data:{action:"sendSmsCode",params:{mobile:this.mobile}},success:function(t){0==t.result.code?(e.showModal({content:"验证码发送成功，请注意查收",showCancel:!1}),n.codeDuration=60,n.codeInterVal=setInterval((function(){n.codeDuration--,0===n.codeDuration&&n.codeInterVal&&(clearInterval(n.codeInterVal),n.codeInterVal=null)}),1e3)):e.showModal({content:"验证码发送失败："+t.result.msg,showCancel:!1})},fail:function(n){e.showModal({content:"验证码发送失败",showCancel:!1})}}):e.showModal({content:"手机号码填写错误",showCancel:!1})},loginByPwd:function(){if(this.username.length<3)e.showToast({icon:"none",title:"账号最短为 3 个字符"});else if(this.password.length<6)e.showToast({icon:"none",title:"密码最短为 6 个字符"});else{this.username,this.password;var n=this;e.setStorageSync("username",this.username),e.setStorageSync("login_type","online"),n.toMain(n.username)}},loginBySms:function(){if(/^1\d{10}$/.test(this.mobile))if(/^\d{6}$/.test(this.code)){var n=this;o.callFunction({name:"user-center",data:{action:"loginBySms",params:{mobile:this.mobile,code:this.code}},success:function(t){if(console.log("login success",t),0==t.result.code){var o=t.result.username||"新用户";e.setStorageSync("uniIdToken",t.result.token),e.setStorageSync("username",o),e.setStorageSync("login_type","online"),n.toMain(o)}else e.showModal({content:t.result.msg,showCancel:!1}),console.log("登录失败",t)},fail:function(n){e.showModal({content:JSON.stringify(n),showCancel:!1})}})}else e.showModal({title:"验证码为6位纯数字",showCancel:!1});else e.showModal({content:"手机号码填写错误",showCancel:!1})},bindLogin:function(){switch(this.loginType){case 0:this.loginByPwd();break;case 1:this.loginBySms();break;default:break}},oauth:function(n){var t=this;console.log("三方登录只演示登录api能力，暂未关联云端数据"),e.login({provider:n,success:function(o){e.getUserInfo({provider:n,success:function(e){t.loginLocal(e.userInfo.nickName)},fail:function(){e.showToast({icon:"none",title:"登陆失败"})}})},fail:function(e){console.error("授权登录失败："+JSON.stringify(e))}})},getUserInfo:function(n){var t=n.detail;console.log("三方登录只演示登录api能力，暂未关联云端数据"),t.userInfo?this.loginLocal(t.userInfo.nickName):e.showToast({icon:"none",title:"登陆失败"})},loginLocal:function(n){e.setStorageSync("login_type","local"),e.setStorageSync("username",n),this.toMain(n)},toMain:function(n){this.login(n),this.forcedLogin?e.navigateBack():e.reLaunch({url:"../main/main"})}}),onReady:function(){this.initPosition(),this.initProvider(),this.isDevtools="devtools"===e.getSystemInfoSync().platform}};n.default=u}).call(this,t("543d")["default"],t("a9ff")["default"])},ddc5:function(e,n,t){"use strict";(function(e){t("edfa");o(t("66fd"));var n=o(t("1245"));function o(e){return e&&e.__esModule?e:{default:e}}e(n.default)}).call(this,t("543d")["createPage"])},f54b:function(e,n,t){"use strict";var o=t("7471"),i=t.n(o);i.a},f705:function(e,n,t){"use strict";var o,i=function(){var e=this,n=e.$createElement;e._self._c},s=[];t.d(n,"b",(function(){return i})),t.d(n,"c",(function(){return s})),t.d(n,"a",(function(){return o}))}},[["ddc5","common/runtime","common/vendor"]]]);